# Mapbox Styleに関するあれこれ

[Mapbox Style Specification](https://docs.mapbox.com/mapbox-gl-js/style-spec/)に準拠して、地図デザインを行う際のTips、躓いた点、やりたいことなどのメモ

## 縦書き
text-writing-modeを利用すると、縦書きに対応できる。
* text-letter-spacingは縦書きにも効く。
* 長符「ー」が横書きのまま表示される。これは、mapbox-gl.js内の横書き用文字→縦書き用文字の変換リストにないため。試しに、`"ー":"｜",` を追加してテストしてみたらうまくいった。
* データドリブンな表現はできないので、データの属性値に応じて、縦横の指定を行うのはできない。その代わり、縦書きか横書きかの優先度を指定する。
* text-variable-anchor等と合わせて、なるべく多くの注記を表示するという運用を想定しているのかもしれない。

## ポリゴンの外周線
ポリゴンの外周線を自由度高く表示するには、ポリゴンとは別にラインとしてレイヤを設定するのがベストなのかもしれない。
* ポリゴン（"type"に"fill"を指定）の外周線を表示する場合、"fill-outline-color"を利用するのが一般的のようだ。
  * しかし、"fill-outline-color"では、色の指定しかできないようだ。
  * そのため、線の太さや破線表現ができない。
* ベクトルタイルデータ自体がポリゴンであっても、スタイル上はライン（"type"は"line"を指定）として表示することはできる。
  * ポリゴンの外周線のみがラインとして表示されることになる。
* 実装方法としては、まず、外周線のラインを描画し、その上にポリゴンを描画する。
  * タイル境界等でラインが表示されてしまうが、ポリゴンを描画する（ポリゴンで塗りつぶす）ことで、隠すことができる。
  * 外周線は、ポリゴンからはみ出す形で描画されるので注意。（なお、"line-width"は最終的な希望の太さの2倍にする必要がある。）

## ラインに沿ってテキストを表示させる
* 文字や数字等のテキストをラインデータに沿って表示させる（"symbol-placement"を"line"に設定する）場合、"text-max-angle"を緩めに設定しておくほうが良い。

## 矢印の表現
* 矢印マークの表現を表現する王道の方法はなさそうであるが、いくつか案がある。
* ラインデータの場合
  * 「＞」のような画像（icon-image）を表示したうえで、ラインデータと合わせて実装する。 
    * 実際には、「　＞」のように、空白を入れた画像として、矢印がなるべくラインデータの先端に表示されるようにする。
    * "symbol-placement"を"line-center"に設定
    * "icon-rotate"は効かないが、何らかの値を設定しておかねば、うまく表示されなかったと記憶している。
  * 「→」そのものを"icon-image"として表示する。
    * 未検証。
* ポイントデータの場合
  * この場合は、アイコンの向き（"icon-rotate"）とアイコンの大きさ（"icon-size"）をデータドリブンで調整することができるかもしれない。（矢印の羽の大きさもicon-sizeに伴い、変更されてしまうが。）
    * 未検証。



